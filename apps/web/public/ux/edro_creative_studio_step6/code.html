<!DOCTYPE html>
<html class="light" lang="pt-br"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Edro Creative Studio - Step 6: Revisão &amp; Ações</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=Playfair+Display:wght@700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ff6600",
                        "background-light": "#ffffff",
                        "background-dark": "#1A1A1A",
                        "sidebar-light": "#F9F9F9",
                        "charcoal": "#1A1A1A",
                        "edro-gray": "#E5E5E5"
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "serif": ["Playfair Display", "serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style type="text/tailwindcss">
        @layer utilities {
            .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
                font-size: 20px;
            }
            .active-nav-border {
                border-left: 3px solid #ff6600;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
<style>
  body.edro-studio-embed aside { display: none !important; }
  body.edro-studio-embed .ml-64 { margin-left: 0 !important; }
  body.edro-studio-embed .left-64 { left: 0 !important; }
  body.edro-studio-embed main > header { display: none !important; }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-charcoal dark:text-white edro-studio-embed">
<div class="flex min-h-screen">
<aside class="w-64 bg-sidebar-light dark:bg-background-dark border-r border-edro-gray dark:border-zinc-800 flex flex-col justify-between fixed h-full z-20">
<div class="flex flex-col">
<div class="p-6 flex items-center gap-3 border-b border-edro-gray dark:border-zinc-800 mb-4">
<div class="bg-primary size-8 rounded flex items-center justify-center text-white">
<span class="material-symbols-outlined">grid_view</span>
</div>
<div>
<h1 class="text-charcoal dark:text-white text-sm font-bold tracking-tight">Edro Creative</h1>
<p class="text-xs text-zinc-500">Creative Studio</p>
</div>
</div>
<nav class="flex flex-col gap-1 px-3">
<a class="flex items-center gap-3 px-3 py-2 text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded transition-colors group" href="#">
<span class="material-symbols-outlined group-hover:text-primary">dashboard</span>
<span class="text-sm font-medium">Dashboard</span>
</a>
<a class="flex items-center gap-3 px-3 py-2 bg-white dark:bg-zinc-800 active-nav-border rounded-r text-charcoal dark:text-white transition-colors shadow-sm" href="#">
<span class="material-symbols-outlined text-primary">auto_awesome</span>
<span class="text-sm font-bold">Studio Setup</span>
</a>
<a class="flex items-center gap-3 px-3 py-2 text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded transition-colors group" href="#">
<span class="material-symbols-outlined group-hover:text-primary">folder_open</span>
<span class="text-sm font-medium">Campanhas</span>
</a>
<a class="flex items-center gap-3 px-3 py-2 text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded transition-colors group" href="#">
<span class="material-symbols-outlined group-hover:text-primary">image</span>
<span class="text-sm font-medium">Biblioteca de Assets</span>
</a>
</nav>
</div>
<div class="p-6 flex flex-col gap-4 border-t border-edro-gray dark:border-zinc-800">
<div class="flex items-center gap-3 mb-2">
<div class="size-8 rounded-full bg-cover bg-center border border-zinc-200" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBt0WNPUzBWw-qN0Iazpchx5OH2gDyLkKjgEnOygyHuPzkpST9aZ_4C_evyJXr3Xn4tWJxyR0nVRSPUDvRUFVJVaVNq3p5C3nOpE1NBfbz-xGu9Yc04WSDd3a8dNiaT8Yxi2TJlJv67sJ4HkUlCoiVD1pjF_zuQ9lFElz6P0Jb_rjMWmtibwK5LnFQxCKvU4gQn9I_C-2b-zyPD_s_sz2mD0PehkyucxaMcldWLW0k0JUi0yWud28peCtrLB0iiTZMu9ftUtw3WGq8')"></div>
<div class="overflow-hidden">
<p class="text-xs font-bold truncate">Julian Edro</p>
<p class="text-[10px] text-zinc-400 truncate uppercase">Premium Plan</p>
</div>
</div>
</div>
</aside>
<main class="flex-1 ml-64 min-h-screen flex flex-col">
<header class="sticky top-0 z-10 bg-white dark:bg-background-dark border-b border-edro-gray dark:border-zinc-800 h-16 px-8 flex items-center justify-between">
<div class="flex items-center gap-4">
<div class="flex items-center gap-2 text-zinc-400 text-[10px] font-bold uppercase tracking-widest">
<span>Creative Studio</span>
<span class="material-symbols-outlined text-sm">chevron_right</span>
<span class="text-charcoal dark:text-white">Revisão &amp; Ações</span>
</div>
</div>
<div class="flex items-center gap-6">
<div class="flex items-center gap-3">
<button class="p-2 text-zinc-400 hover:text-charcoal dark:hover:text-white">
<span class="material-symbols-outlined">notifications</span>
</button>
<button class="p-2 text-zinc-400 hover:text-charcoal dark:hover:text-white">
<span class="material-symbols-outlined">help_outline</span>
</button>
</div>
</div>
</header>
<div class="flex flex-1 overflow-hidden">
<div class="flex-1 p-8 overflow-y-auto">
<div class="mb-10">
<h2 class="font-serif text-5xl text-charcoal dark:text-white leading-tight mb-2">Revisão &amp; Ações</h2>
<p class="text-zinc-500 text-lg">Confira todos os assets gerados e finalize sua campanha.</p>
</div>
<div class="flex items-center justify-between mb-8 border-b border-edro-gray dark:border-zinc-800">
<div class="flex gap-8">
<button id="edro-tab-all" class="pb-4 text-sm font-bold border-b-2 border-primary text-charcoal dark:text-white">TODOS (0)</button>
<button id="edro-tab-draft" class="pb-4 text-sm font-medium text-zinc-400 hover:text-charcoal dark:hover:text-white transition-colors">RASCUNHO (0)</button>
<button id="edro-tab-ready" class="pb-4 text-sm font-medium text-zinc-400 hover:text-charcoal dark:hover:text-white transition-colors">PRONTO (0)</button>
<button id="edro-tab-approved" class="pb-4 text-sm font-medium text-zinc-400 hover:text-charcoal dark:hover:text-white transition-colors">APROVADO (0)</button>
</div>
<div class="flex items-center gap-4 pb-4">
<button class="flex items-center gap-2 text-xs font-bold text-zinc-500 uppercase tracking-wider">
<span class="material-symbols-outlined">filter_list</span>
                                Filtrar
                            </button>
<div class="h-4 w-px bg-edro-gray"></div>
<button class="flex items-center gap-2 text-xs font-bold text-zinc-500 uppercase tracking-wider">
<span class="material-symbols-outlined">sort</span>
                                Ordenar
                            </button>
</div>
</div>
<div id="edro-review-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
</div>
<aside class="w-80 border-l border-edro-gray dark:border-zinc-800 bg-white dark:bg-background-dark p-6 flex flex-col gap-8 overflow-y-auto sticky top-16 h-[calc(100vh-64px)]">
<section>
<h3 class="text-[10px] font-bold uppercase tracking-widest text-zinc-400 mb-6">Resumo da Campanha</h3>
<div class="space-y-4">
<div>
<label class="text-[10px] font-bold text-zinc-400 uppercase">Cliente</label>
<p id="edro-summary-client" class="text-sm font-bold text-charcoal dark:text-white mt-1">-</p>
</div>
<div>
<label class="text-[10px] font-bold text-zinc-400 uppercase">Data Prevista</label>
<p id="edro-summary-date" class="text-sm font-medium text-charcoal dark:text-white mt-1">-</p>
</div>
<div>
<label class="text-[10px] font-bold text-zinc-400 uppercase">Objetivo</label>
<p id="edro-summary-objective" class="text-sm font-medium text-charcoal dark:text-white mt-1">-</p>
</div>
<div>
<label class="text-[10px] font-bold text-zinc-400 uppercase">Tema Central</label>
<p id="edro-summary-theme" class="text-sm font-medium text-charcoal dark:text-white mt-1">-</p>
</div>
</div>
</section>
<section class="bg-sidebar-light dark:bg-zinc-900/50 p-4 rounded border border-edro-gray dark:border-zinc-800">
<h3 class="text-[10px] font-bold uppercase tracking-widest text-zinc-400 mb-4">Estatísticas dos Posts</h3>
<div class="grid grid-cols-2 gap-4">
<div class="text-center p-2">
<p id="edro-stat-approved" class="text-2xl font-serif text-charcoal dark:text-white">0</p>
<p class="text-[9px] font-bold text-zinc-400 uppercase">Aprovados</p>
</div>
<div class="text-center p-2">
<p id="edro-stat-exported" class="text-2xl font-serif text-charcoal dark:text-white">0</p>
<p class="text-[9px] font-bold text-zinc-400 uppercase">Exportados</p>
</div>
</div>
</section>
<section class="mt-auto space-y-3">
<button data-action="approve" class="w-full py-3 bg-primary text-white text-xs font-bold rounded hover:bg-orange-600 transition-all flex items-center justify-center gap-2 uppercase tracking-widest">
<span class="material-symbols-outlined !text-lg">send</span>
                            Enviar para aprovação
                        </button>
<button data-action="export-copy" class="w-full py-3 border border-charcoal dark:border-white text-charcoal dark:text-white text-xs font-bold rounded hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all flex items-center justify-center gap-2 uppercase tracking-widest">
<span class="material-symbols-outlined !text-lg">description</span>
                            Exportar copys
                        </button>
<button data-action="draft" class="w-full py-3 text-zinc-500 hover:text-charcoal dark:hover:text-white text-[10px] font-bold uppercase tracking-widest transition-colors">
                            Salvar como rascunho
                        </button>
</section>
</aside>
</div>
</main>
</div>

<script src="/ux/edro-studio-api.js"></script>
<script>
  (function () {
    const safeParse = (value, fallback) => {
      try {
        const parsed = JSON.parse(value || '');
        return parsed ?? fallback;
      } catch {
        return fallback;
      }
    };

    const escapeHtml = (value) =>
      String(value || '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');

    const displayMap = safeParse(localStorage.getItem('edro_platform_display_map'), {});
    const context = safeParse(localStorage.getItem('edro_studio_context'), {});
    const inventory = safeParse(localStorage.getItem('edro_selected_inventory'), []);
    const mockups = safeParse(localStorage.getItem('edro_mockups'), []);
    const exportsData = safeParse(localStorage.getItem('edro_exports'), []);
    const copyMap = safeParse(localStorage.getItem('edro_copy_by_platform_format'), {});
    const defaultCopyKey = 'edro_copy_text';
    const statusKey = 'edro_asset_status';

    const grid = document.getElementById('edro-review-grid');
    const tabAll = document.getElementById('edro-tab-all');
    const tabDraft = document.getElementById('edro-tab-draft');
    const tabReady = document.getElementById('edro-tab-ready');
    const tabApproved = document.getElementById('edro-tab-approved');

    const summaryClient = document.getElementById('edro-summary-client');
    const summaryDate = document.getElementById('edro-summary-date');
    const summaryObjective = document.getElementById('edro-summary-objective');
    const summaryTheme = document.getElementById('edro-summary-theme');
    const statApproved = document.getElementById('edro-stat-approved');
    const statExported = document.getElementById('edro-stat-exported');

    let statusMap = safeParse(localStorage.getItem(statusKey), {});

    const getLabel = (platform, format) => {
      const platformLabel = displayMap?.[platform] || String(platform || '').replace(/([a-z])([A-Z])/g, '$1 $2');
      return `${platformLabel} • ${format || 'Formato'}`;
    };

    const toStatus = (asset) => {
      const saved = statusMap?.[asset.id];
      if (saved) return saved;
      const match = mockups.find(
        (item) => item.id === asset.id || (item.platform === asset.platform && item.format === asset.format)
      );
      return match?.generated ? 'pronto' : 'rascunho';
    };

    const statusMeta = (status) => {
      if (status === 'aprovado') return { label: 'Aprovado', cls: 'bg-green-100 text-green-700' };
      if (status === 'pronto') return { label: 'Pronto', cls: 'bg-orange-100 text-orange-700' };
      return { label: 'Rascunho', cls: 'bg-zinc-100 text-zinc-500' };
    };

    const formatDate = (value) => {
      if (!value) return '-';
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return String(value);
      return date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short', year: 'numeric' });
    };

    const buildAssets = () => {
      if (!inventory.length) return [];
      return inventory.map((item, index) => ({
        ...item,
        id: item.id || `${item.platform || 'platform'}-${item.format || 'format'}-${index}`,
      }));
    };

    const updateCounts = (assets) => {
      const counts = { total: assets.length, rascunho: 0, pronto: 0, aprovado: 0 };
      assets.forEach((asset) => {
        const status = toStatus(asset);
        counts[status] += 1;
      });
      if (tabAll) tabAll.textContent = `TODOS (${counts.total})`;
      if (tabDraft) tabDraft.textContent = `RASCUNHO (${counts.rascunho})`;
      if (tabReady) tabReady.textContent = `PRONTO (${counts.pronto})`;
      if (tabApproved) tabApproved.textContent = `APROVADO (${counts.aprovado})`;
      if (statApproved) statApproved.textContent = String(counts.aprovado).padStart(2, '0');
      if (statExported) statExported.textContent = String(exportsData.length).padStart(2, '0');
    };

    const render = () => {
      const assets = buildAssets();
      updateCounts(assets);
      if (!grid) return;
      if (!assets.length) {
        grid.innerHTML = '<div class="text-sm text-zinc-400">Nenhum asset disponível para revisão.</div>';
        return;
      }

      grid.innerHTML = assets
        .map((asset) => {
          const status = toStatus(asset);
          const badge = statusMeta(status);
          const label = getLabel(asset.platform, asset.format);
          const key = `${asset.platform}::${asset.format}`;
          const latestCopy = localStorage.getItem(defaultCopyKey) || '';
          const snippet = copyMap[key] || latestCopy || context.message || '';
          return `
            <div class="bg-white dark:bg-zinc-900 border border-edro-gray dark:border-zinc-800 rounded-lg overflow-hidden card-shadow group">
              <div class="aspect-square bg-zinc-100 dark:bg-zinc-800 relative">
                <div class="absolute inset-0 bg-gradient-to-br from-zinc-100 via-white to-zinc-200 dark:from-zinc-800 dark:via-zinc-900 dark:to-zinc-800"></div>
                <div class="absolute top-3 right-3">
                  <span class="${badge.cls} text-[10px] font-bold px-2 py-1 rounded uppercase">${badge.label}</span>
                </div>
                <div class="absolute inset-0 flex flex-col items-center justify-center text-center px-6">
                  <p class="text-xs font-bold text-zinc-700 dark:text-zinc-200 uppercase tracking-wider">${escapeHtml(label)}</p>
                  <p class="text-[10px] text-zinc-400 mt-2">Preview gerado pelo Studio</p>
                </div>
              </div>
              <div class="p-4">
                <div class="flex justify-between items-start mb-2">
                  <h4 class="text-sm font-bold text-charcoal dark:text-white">${escapeHtml(label)}</h4>
                  <button class="text-zinc-400 hover:text-primary transition-colors">
                    <span class="material-symbols-outlined">more_vert</span>
                  </button>
                </div>
                <p class="text-xs text-zinc-500 mb-4 line-clamp-2">${escapeHtml(snippet)}</p>
                <div class="flex items-center justify-between border-t border-edro-gray dark:border-zinc-800 pt-4">
                  <span class="text-[10px] text-zinc-400 font-bold uppercase">${escapeHtml(label)}</span>
                  <div class="flex gap-2">
                    <button class="p-1.5 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-500">
                      <span class="material-symbols-outlined !text-base">edit</span>
                    </button>
                    <button class="p-1.5 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-500">
                      <span class="material-symbols-outlined !text-base">download</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
        })
        .join('');
    };

    const updateSummary = () => {
      if (summaryClient) summaryClient.textContent = context.client || '-';
      if (summaryDate) summaryDate.textContent = context.date ? formatDate(context.date) : '-';
      if (summaryObjective) summaryObjective.textContent = context.objective || '-';
      if (summaryTheme) summaryTheme.textContent = context.event || '-';
    };

    const setStatusForAll = (status) => {
      const assets = buildAssets();
      statusMap = {};
      assets.forEach((asset) => {
        statusMap[asset.id] = status;
      });
      localStorage.setItem(statusKey, JSON.stringify(statusMap));
      render();
    };

    const downloadCopy = () => {
      const assets = buildAssets();
      const lines = assets.map((asset, index) => {
        const label = getLabel(asset.platform, asset.format);
        const key = `${asset.platform}::${asset.format}`;
        const latestCopy = localStorage.getItem(defaultCopyKey) || '';
        const snippet = copyMap[key] || latestCopy || context.message || 'Sem copy gerada';
        return `#${index + 1} ${label}\n${snippet}\n`;
      });
      const blob = new Blob([lines.join('\n')], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `copys-${new Date().toISOString().slice(0, 10)}.txt`;
      document.body.appendChild(link);
      link.click();
      link.remove();
      URL.revokeObjectURL(url);
    };

    const updateStage = async (stage, status) => {
      const briefingId = localStorage.getItem('edro_briefing_id');
      if (!briefingId || !window.EdroStudio?.request) return;
      try {
        await window.EdroStudio.request(`/edro/briefings/${briefingId}/stages/${stage}`, {
          method: 'PATCH',
          body: JSON.stringify({ status }),
        });
      } catch {
        // ignore workflow conflicts
      }
    };

    const approveButton = document.querySelector('[data-action="approve"]');
    if (approveButton) {
      approveButton.addEventListener('click', () => {
        setStatusForAll('aprovado');
        updateStage('aprovacao', 'done');
      });
    }

    const draftButton = document.querySelector('[data-action="draft"]');
    if (draftButton) {
      draftButton.addEventListener('click', () => {
        setStatusForAll('rascunho');
      });
    }

    const exportCopyButton = document.querySelector('[data-action="export-copy"]');
    if (exportCopyButton) {
      exportCopyButton.addEventListener('click', downloadCopy);
    }

    const loadCopies = async () => {
      const briefingId = localStorage.getItem('edro_briefing_id');
      if (!briefingId || !window.EdroStudio?.request) return;
      try {
        const response = await window.EdroStudio.request(`/edro/briefings/${briefingId}`);
        const copies = response?.data?.copies || response?.copies || [];
        if (Array.isArray(copies) && copies.length) {
          const latest = copies[0];
          if (latest?.output) {
            localStorage.setItem('edro_copy_text', latest.output);
          }
        }
      } catch {
        // ignore
      }
    };

    updateStage('revisao', 'in_progress');
    updateSummary();
    loadCopies().finally(render);
  })();
</script>
<script src="/ux/edro-links.js"></script>
</body></html>


