<!DOCTYPE html>
<html class="light" lang="pt-BR"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Platform Selection - Edro Creative Studio</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&amp;family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
<script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#FF6600",
              "background-light": "#F9FAFB",
              "background-dark": "#0F172A",
              "surface-light": "#FFFFFF",
              "surface-dark": "#1E293B",
            },
            fontFamily: {
              display: ["Instrument Serif", "serif"],
              sans: ["Inter", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "12px",
              'xl': '16px',
            },
          },
        },
      };
    </script>
<style type="text/tailwindcss">
        body { font-family: 'Inter', sans-serif; }
        .font-display { font-family: 'Instrument Serif', serif; }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }
        .platform-card:hover .platform-logo { transform: scale(1.1); }
        .platform-logo { transition: transform 0.2s ease; }
        .platform-card.has-pieces .platform-logo { color: var(--active-color, #FF6600) !important; }
        .platform-card:not(.has-pieces) .platform-logo { color: #94a3b8 !important; }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 antialiased min-h-screen flex">
<aside class="w-36 shrink-0 border-r border-slate-200 dark:border-slate-800 bg-surface-light dark:bg-surface-dark flex flex-col sticky top-0 h-screen overflow-y-auto">
  <div class="px-6 pt-6 pb-4">
    <div class="flex items-center gap-3">
      <img class="h-16 w-16 rounded-xl object-contain" src="/assets/logo-studio.png" alt="Studio logo">
      <div>
      </div>
    </div>
  </div>
  <nav class="px-4 py-2 space-y-1 text-sm">
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" href="#">
      <span class="material-symbols-outlined text-[20px]">home</span>
      <span>Home</span>
    </a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" href="#">
      <span class="material-symbols-outlined text-[20px]">group</span>
      <span>Clients</span>
    </a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" href="#">
      <span class="material-symbols-outlined text-[20px]">calendar_month</span>
      <span>Calendar</span>
    </a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" href="#">
      <span class="material-symbols-outlined text-[20px]">view_kanban</span>
      <span>Kanban</span>
    </a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" href="#">
      <span class="material-symbols-outlined text-[20px]">palette</span>
      <span>Creative Studio</span>
    </a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" href="#">
      <span class="material-symbols-outlined text-[20px]">content_cut</span>
      <span>Clipping</span>
    </a>
  </nav>
  <div class="mt-auto p-6">
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors" href="#">
      <span class="material-symbols-outlined text-xl">settings</span>
      <span>Settings</span>
    </a>
  </div>
</aside>
<main class="flex-1 flex flex-col h-screen overflow-hidden bg-slate-50 dark:bg-slate-900/50">
<header class="h-16 border-b border-slate-200 dark:border-slate-800 bg-surface-light dark:bg-surface-dark flex items-center justify-between px-8 shrink-0 z-10">
<div class="flex items-center gap-4">
<h1 class="font-display text-2xl">Campaign Strategy</h1>
<div class="w-px h-6 bg-slate-200 dark:bg-slate-700"></div>
<span class="text-sm font-medium text-slate-500 uppercase tracking-wide">Step 2 of 4</span>
<div class="flex items-center gap-2 rounded-full bg-slate-100 dark:bg-slate-800 px-3 py-1 text-xs font-semibold text-slate-600 dark:text-slate-300">
<span class="material-symbols-outlined text-[16px]">event</span>
22/01/2026
</div>
</div>
<div class="flex items-center gap-6">
<button class="relative p-2 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors">
<span class="material-symbols-outlined text-[24px]">notifications</span>
<span class="absolute top-2 right-2 w-2 h-2 bg-primary rounded-full border-2 border-white dark:border-slate-800"></span>
</button>
<div class="flex items-center gap-3">
<div class="text-right">
<p class="text-sm font-semibold leading-none text-slate-900 dark:text-white">Alex Rivera</p>
<p class="text-xs text-slate-500 dark:text-slate-400">Creative Director</p>
</div>
<img alt="Profile avatar" class="w-10 h-10 rounded-full border border-slate-200 dark:border-slate-700 object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBvAk3odobYSg1Pbv6JIgSldZBi3DFIUUztWB6XUe29WkmbpW3iFxm-up5sdxcN7wplROm6if2NtRMvS5bb6eLDxYHZjyg2sZG2jI54RdIn5M9XfG34WVWVVktcPqSC5sKOxJHdtj8OhvGhzjiYoVvwj6---zaiH2XiafvYl2dNjjJAW7G6dxcJw6Y_lTrUasNpunsU3fpzMIusTbzbf2YlDLd2lHYQzr8AxNFZNtWL8l2XegBDh5cQ5xZjXw8d7ePCQIzwRbE-RXY"/>
</div>
</div>
</header>
<div class="flex-1 overflow-y-auto">
<div class="max-w-none p-8 pb-32">
<div class="mb-8">
<h1 class="font-display text-4xl text-slate-900 dark:text-white mb-2">Select Platform &amp; Format</h1>
<p class="text-slate-500 dark:text-slate-400 text-lg">Based on your strategic objective: <span class="font-semibold text-slate-900 dark:text-white bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded">Awareness</span></p>
</div>
<div class="bg-orange-50 dark:bg-orange-950/20 border border-orange-100 dark:border-orange-900/40 rounded-xl p-6 mb-10 flex gap-5 items-start relative overflow-hidden group">
<div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
<span class="material-symbols-outlined text-9xl text-orange-500">auto_awesome</span>
</div>
<div class="w-10 h-10 rounded-full bg-white dark:bg-orange-900/50 text-primary flex items-center justify-center shrink-0 shadow-sm border border-orange-100 dark:border-orange-800">
<span class="material-symbols-outlined">auto_awesome</span>
</div>
<div class="relative z-10">
<h3 class="font-bold text-orange-900 dark:text-orange-100 text-lg mb-1 flex items-center gap-2">
                            AI Recommendation: Instagram Carousel
                            <span class="px-2 py-0.5 bg-white/50 dark:bg-black/20 rounded-full text-[10px] font-bold uppercase tracking-wider text-orange-700 dark:text-orange-300 border border-orange-200 dark:border-orange-800">High Impact</span>
</h3>
<p class="text-orange-800/80 dark:text-orange-200/70 text-sm leading-relaxed max-w-2xl">
                            For an <strong>Awareness</strong> objective, carousels on Instagram currently drive <strong>2.5x higher engagement</strong> than static posts. The visual storytelling format allows for deeper education about the narrative while leveraging the algorithm's re-serving behavior.
                        </p>
</div>
</div>
<section class="mb-12">
<h2 class="font-display text-2xl text-slate-900 dark:text-white mb-6 flex items-center gap-3">
<span class="flex items-center justify-center w-6 h-6 rounded-full bg-slate-200 dark:bg-slate-700 text-xs font-bold font-sans">1</span>
                    Choose Platform
                </h2>
<div class="grid grid-cols-7 gap-4">
<div class="platform-card cursor-pointer bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 hover:border-primary dark:hover:border-primary rounded-xl p-6 flex flex-col items-center gap-4 transition-all hover:shadow-md group relative" data-platform="Instagram" data-selected="false" style="--active-color:#E1306C">
<div class="platform-count absolute top-3 right-3 hidden items-center justify-center min-w-[22px] h-6 px-2 rounded-full bg-primary text-white text-[11px] font-bold shadow-sm"></div>
<div class="w-12 h-12 platform-logo text-slate-900 dark:text-white">
<svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"></path></svg>
</div>
<span class="font-bold text-sm text-slate-900 dark:text-white">Instagram</span>
</div>
<div class="platform-card cursor-pointer bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 hover:border-primary dark:hover:border-primary rounded-xl p-6 flex flex-col items-center gap-4 transition-all hover:shadow-md group relative" data-platform="LinkedIn" style="--active-color:#0077B5">
<div class="platform-count absolute top-3 right-3 hidden items-center justify-center min-w-[22px] h-6 px-2 rounded-full bg-primary text-white text-[11px] font-bold shadow-sm"></div>
<div class="w-12 h-12 platform-logo text-slate-400 group-hover:text-[#0077b5] transition-colors">
<svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg>
</div>
<span class="font-bold text-sm text-slate-500 group-hover:text-slate-900 dark:text-slate-400 dark:group-hover:text-white">LinkedIn</span>
</div>
<div class="platform-card cursor-pointer bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 hover:border-primary dark:hover:border-primary rounded-xl p-6 flex flex-col items-center gap-4 transition-all hover:shadow-md group relative" data-platform="Facebook" style="--active-color:#1877F2">
<div class="platform-count absolute top-3 right-3 hidden items-center justify-center min-w-[22px] h-6 px-2 rounded-full bg-primary text-white text-[11px] font-bold shadow-sm"></div>
<div class="w-12 h-12 platform-logo text-slate-400 group-hover:text-[#1877F2] transition-colors">
<svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg>
</div>
<span class="font-bold text-sm text-slate-500 group-hover:text-slate-900 dark:text-slate-400 dark:group-hover:text-white">Facebook</span>
</div>
<div class="platform-card cursor-pointer bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 hover:border-primary dark:hover:border-primary rounded-xl p-6 flex flex-col items-center gap-4 transition-all hover:shadow-md group relative" data-platform="X" style="--active-color:#0F172A">
<div class="platform-count absolute top-3 right-3 hidden items-center justify-center min-w-[22px] h-6 px-2 rounded-full bg-primary text-white text-[11px] font-bold shadow-sm"></div>
<div class="w-12 h-12 platform-logo text-slate-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors">
<svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
</div>
<span class="font-bold text-sm text-slate-500 group-hover:text-slate-900 dark:text-slate-400 dark:group-hover:text-white">X</span>
</div>
<div class="platform-card cursor-pointer bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 hover:border-primary dark:hover:border-primary rounded-xl p-6 flex flex-col items-center gap-4 transition-all hover:shadow-md group relative" data-platform="TikTok" style="--active-color:#111827">
<div class="platform-count absolute top-3 right-3 hidden items-center justify-center min-w-[22px] h-6 px-2 rounded-full bg-primary text-white text-[11px] font-bold shadow-sm"></div>
<div class="w-12 h-12 platform-logo text-slate-400 group-hover:text-black dark:group-hover:text-white transition-colors">
<svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93v6.16c0 2.52-1.12 4.84-2.9 6.24-1.72 1.36-3.92 1.84-6.11 1.33-2.19-.51-3.97-2.09-4.88-4.14-.91-2.06-.66-4.52.65-6.29 1.3-1.77 3.39-2.73 5.66-2.61v4.18c-1.26-.14-2.54.34-3.35 1.25-.81.9-1.09 2.2-.74 3.37.35 1.17 1.32 2.05 2.52 2.27 1.2.22 2.45-.19 3.25-1.07.8-.88 1.08-2.16.74-3.32V.02z"></path></svg>
</div>
<span class="font-bold text-sm text-slate-500 group-hover:text-slate-900 dark:text-slate-400 dark:group-hover:text-white">TikTok</span>
</div>
<div class="platform-card cursor-pointer bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 hover:border-primary dark:hover:border-primary rounded-xl p-6 flex flex-col items-center gap-4 transition-all hover:shadow-md group relative" data-platform="Google Ads" style="--active-color:#FF6600">
<div class="platform-count absolute top-3 right-3 hidden items-center justify-center min-w-[22px] h-6 px-2 rounded-full bg-primary text-white text-[11px] font-bold shadow-sm"></div>
<div class="w-12 h-12 platform-logo text-slate-400 group-hover:text-primary transition-colors flex items-center justify-center">
<span class="material-symbols-outlined text-4xl">campaign</span>
</div>
<span class="font-bold text-sm text-slate-500 group-hover:text-slate-900 dark:text-slate-400 dark:group-hover:text-white">Google Ads</span>
</div>
<div class="platform-card cursor-pointer bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 hover:border-primary dark:hover:border-primary rounded-xl p-6 flex flex-col items-center gap-4 transition-all hover:shadow-md group relative" data-platform="Email Marketing" style="--active-color:#FF6600">
<div class="platform-count absolute top-3 right-3 hidden items-center justify-center min-w-[22px] h-6 px-2 rounded-full bg-primary text-white text-[11px] font-bold shadow-sm"></div>
<div class="w-12 h-12 platform-logo text-slate-400 group-hover:text-primary transition-colors flex items-center justify-center">
<span class="material-symbols-outlined text-4xl">mail</span>
</div>
<span class="font-bold text-sm text-slate-500 group-hover:text-slate-900 dark:text-slate-400 dark:group-hover:text-white">Email Mkt</span>
</div>
</div>
</section>
<section class="mb-12 animate-in slide-in-from-bottom-4 duration-500 fade-in">
<div class="flex items-center justify-between mb-4">
<h2 class="font-display text-2xl text-slate-900 dark:text-white flex items-center gap-3">
<span class="flex items-center justify-center w-6 h-6 rounded-full bg-slate-200 dark:bg-slate-700 text-xs font-bold font-sans">2</span>
                    Choose Format
                </h2>
<div class="flex items-center gap-2">
  <button class="text-[11px] font-bold uppercase tracking-widest text-primary border border-orange-200 dark:border-orange-800 px-3 py-1 rounded-full hover:bg-orange-50 dark:hover:bg-orange-950/30 transition-colors" id="select-all-formats" type="button">Select All</button>
  <button class="text-[11px] font-bold uppercase tracking-widest text-slate-500 border border-slate-200 dark:border-slate-700 px-3 py-1 rounded-full hover:bg-slate-50 dark:hover:bg-slate-800/40 transition-colors" id="unselect-all-formats" type="button">Unselect All</button>
</div>
</div>
<p class="text-xs text-slate-500 mb-1" id="selected-formats">Select platforms and formats.</p>
<p class="text-xs text-slate-400 mb-4">Copies will be generated for every selected format, following each platform’s best practices.</p>
<div id="format-grid" class="grid grid-cols-4 gap-6"></div>
</section>

<section class="mt-10">
  <div class="bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 rounded-xl p-6">
    <div class="flex items-center gap-3 mb-4">
      <span class="flex items-center justify-center w-6 h-6 rounded-full bg-slate-200 dark:bg-slate-700 text-xs font-bold font-sans">3</span>
      <h2 class="font-display text-2xl text-slate-900 dark:text-white">Selected Inventory</h2>
    </div>
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <div class="flex items-center gap-3">
          <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-200">Inventory Summary</h3>
          <span id="inventory-total" class="text-xs text-slate-400">0 pieces</span>
        </div>
        <p class="text-xs text-slate-500 dark:text-slate-400">Review the pieces to generate copy for each format.</p>
      </div>
      <button id="enter-studio-btn" class="px-5 py-3 rounded-xl bg-primary text-white font-semibold shadow-md hover:shadow-lg transition-shadow">
        Continue to Copy Studio
      </button>
    </div>
    <div id="inventory-empty" class="mt-4 text-sm text-slate-400">Select formats to build the inventory.</div>
    <div id="inventory-list" class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3 hidden"></div>
  </div>
</section>
</div>
</div>
</main>
<button class="fixed bottom-24 right-8 w-12 h-12 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-full shadow-xl flex items-center justify-center hover:scale-110 transition-transform z-50" onclick="document.documentElement.classList.toggle('dark')">
<span class="material-symbols-outlined text-slate-600 dark:text-slate-300">dark_mode</span>
</button>
<script src="/ux/edro-studio-api.js"></script>
<script>
        (function () {
          const platformCards = Array.from(document.querySelectorAll('[data-platform]'));
          const selectAllBtn = document.getElementById('select-all-formats');
          const unselectAllBtn = document.getElementById('unselect-all-formats');
          const summaryEl = document.getElementById('selected-formats');
          const enterBtn = document.getElementById('enter-studio-btn');
          const formatGrid = document.getElementById('format-grid');
          const inventoryList = document.getElementById('inventory-list');
          const inventoryEmpty = document.getElementById('inventory-empty');
          const safeParse = (value, fallback) => {
            try { return JSON.parse(value); } catch { return fallback; }
          };
          const context = safeParse(localStorage.getItem('edro_studio_context'), {});
          const headerDate = document.querySelector('header span.text-xs.font-semibold.text-slate-600');
          if (headerDate && context?.date) {
            headerDate.textContent = context.date;
          }

          const selectedFormats = new Set();
          const selectedPlatforms = new Set();
          let activePlatform = null;
          let formatCounts = {};

          const formatKey = 'edro_selected_formats';
          const platformKey = 'edro_active_platform';
          const platformsKey = 'edro_selected_platforms';
          const formatsByPlatformKey = 'edro_selected_formats_by_platform';
          const countsByPlatformKey = 'edro_selected_format_counts_by_platform';

          let platformFormats = {
            'Instagram': [
              { name: 'Feed Post', meta: '1:1 Aspect', shape: 'square' },
              { name: 'Story', meta: '9:16 Aspect', shape: 'tall' },
              { name: 'Reel', meta: '9:16 Aspect', shape: 'video' },
              { name: 'Carousel', meta: 'Multi-Card', shape: 'stack' }
            ],
            'LinkedIn': [
              { name: 'Single Image', meta: '1:1 Aspect', shape: 'square' },
              { name: 'Document Carousel', meta: 'Multi-Card', shape: 'stack' },
              { name: 'Text Post', meta: 'Text Only', shape: 'text' },
              { name: 'Video Post', meta: '16:9 Aspect', shape: 'video' }
            ],
            'Facebook': [
              { name: 'Feed Post', meta: '1:1 Aspect', shape: 'square' },
              { name: 'Story', meta: '9:16 Aspect', shape: 'tall' },
              { name: 'Reel', meta: '9:16 Aspect', shape: 'video' },
              { name: 'Carousel', meta: 'Multi-Card', shape: 'stack' }
            ],
            'X': [
              { name: 'Single Post', meta: 'Text Only', shape: 'text' },
              { name: 'Thread', meta: 'Multi-Post', shape: 'text' },
              { name: 'Image Post', meta: '1:1 Aspect', shape: 'square' },
              { name: 'Video Post', meta: '16:9 Aspect', shape: 'video' }
            ],
            'TikTok': [
              { name: 'Video', meta: '9:16 Aspect', shape: 'video' },
              { name: 'Photo Carousel', meta: 'Multi-Card', shape: 'stack' },
              { name: 'Spark Ad', meta: '9:16 Aspect', shape: 'video' }
            ],
            'Google Ads': [
              { name: 'Search Ad', meta: 'Text Only', shape: 'text' },
              { name: 'Display Banner', meta: '1.91:1 Aspect', shape: 'wide' },
              { name: 'YouTube Ad', meta: '16:9 Aspect', shape: 'video' },
              { name: 'Performance Max', meta: 'Multi-Asset', shape: 'stack' }
            ],
            'Email Marketing': [
              { name: 'Newsletter', meta: 'Long Form', shape: 'text' },
              { name: 'Promo Blast', meta: 'Short Form', shape: 'text' },
              { name: 'Lifecycle', meta: 'Automated', shape: 'text' },
              { name: 'Nurture Series', meta: 'Multi-Email', shape: 'text' }
            ]
          };
          const platformAliasMap = {
            'Instagram': 'Instagram',
            'LinkedIn': 'LinkedIn',
            'Facebook': 'MetaAds',
            'X': 'X',
            'TikTok': 'TikTok',
            'Google Ads': 'GoogleAds',
            'Email Marketing': 'EmailMarketing'
          };

          const normalizeFormatLabel = (value) => {
            const name = String(value || '').trim();
            const map = {
              Reels: 'Reel',
              Stories: 'Story',
              Carrossel: 'Carousel',
              Feed: 'Feed Post',
              Texto: 'Text Post',
              Documento: 'Document Carousel',
              Imagem: 'Single Image',
              Video: 'Video Post',
              FeedAd: 'Feed Ad',
              StoryAd: 'Story Ad',
              ReelAd: 'Reel Ad',
              CarouselAd: 'Carousel Ad',
              RSA: 'Search Ad',
              Display: 'Display Banner',
              Newsletter: 'Newsletter',
              Promo: 'Promo Blast',
              Nurture: 'Nurture Series',
              Lifecycle: 'Lifecycle'
            };
            return map[name] || name;
          };

          const formatShape = (name) => {
            const text = String(name || '').toLowerCase();
            if (text.includes('story') || text.includes('reel') || text.includes('video')) return 'video';
            if (text.includes('carousel') || text.includes('carrossel') || text.includes('document')) return 'stack';
            if (text.includes('banner') || text.includes('display') || text.includes('cover')) return 'wide';
            if (text.includes('text') || text.includes('texto') || text.includes('newsletter') || text.includes('promo') || text.includes('lifecycle') || text.includes('rsa')) return 'text';
            return 'square';
          };

          const formatMeta = (name) => {
            const text = String(name || '').toLowerCase();
            if (text.includes('story') || text.includes('reel')) return '9:16 Aspect';
            if (text.includes('carousel') || text.includes('carrossel')) return 'Multi-Card';
            if (text.includes('banner') || text.includes('display')) return 'Wide';
            if (text.includes('text') || text.includes('texto') || text.includes('newsletter') || text.includes('promo') || text.includes('lifecycle') || text.includes('rsa')) return 'Text Only';
            return '1:1 Aspect';
          };

          const applyPlatformProfiles = (profiles) => {
            if (!Array.isArray(profiles) || !profiles.length) return;
            const next = { ...platformFormats };
            profiles.forEach((profile) => {
              const display = Object.keys(platformAliasMap).find((key) => platformAliasMap[key] === profile.platform);
              if (!display || !Array.isArray(profile.supportedFormats)) return;
              next[display] = profile.supportedFormats.map((fmt) => {
                const label = normalizeFormatLabel(fmt);
                return {
                  name: label,
                  meta: formatMeta(label),
                  shape: formatShape(label)
                };
              });
            });
            platformFormats = next;
          };

          const loadPlatformProfiles = async () => {
            if (!window.EdroStudio?.request) return;
            try {
              const data = await window.EdroStudio.request('/platforms', { method: 'GET' });
              const profiles = Array.isArray(data) ? data : data?.data || [];
              if (profiles.length) {
                applyPlatformProfiles(profiles);
                localStorage.setItem('edro_platform_profiles', JSON.stringify(profiles));
                localStorage.setItem('edro_platform_alias_map', JSON.stringify(platformAliasMap));
              }
            } catch (error) {
              console.warn('platform profiles load failed', error);
            }
          };

          const formatLabel = (value) => String(value || '').trim();

          const applyPlatformState = (card, isActive) => {
            if (!card) return;
            card.dataset.active = isActive ? 'true' : 'false';
            card.classList.toggle('border-2', isActive);
            card.classList.toggle('border-primary', isActive);
            card.classList.toggle('ring-4', isActive);
            card.classList.toggle('ring-orange-500/10', isActive);
            card.classList.toggle('shadow-lg', isActive);
          };

          const applyFormatState = (card, selected) => {
            const box = card.querySelector('.format-box');
            const label = card.querySelector('.format-label');
            const check = card.querySelector('.format-check');
            if (!box) return;
            box.classList.toggle('border-2', selected);
            box.classList.toggle('border-primary', selected);
            box.classList.toggle('ring-4', selected);
            box.classList.toggle('ring-orange-500/10', selected);
            box.classList.toggle('shadow-md', selected);
            if (!selected) {
              box.classList.add('border');
              box.classList.add('border-slate-200');
              box.classList.add('dark:border-slate-700');
            } else {
              box.classList.remove('border');
              box.classList.remove('border-slate-200');
              box.classList.remove('dark:border-slate-700');
            }
            if (check) check.classList.toggle('hidden', !selected);
            if (label) {
              label.classList.toggle('text-primary', selected);
              label.classList.toggle('text-slate-900', !selected);
            }
          };

          const loadSelectedPlatforms = () => {
            try {
              const stored = JSON.parse(localStorage.getItem(platformsKey) || '[]');
              return Array.isArray(stored) ? stored : [];
            } catch {
              return [];
            }
          };

          const loadFormatStore = () => {
            try {
              return JSON.parse(localStorage.getItem(formatsByPlatformKey) || '{}');
            } catch {
              return {};
            }
          };

          const loadCountStore = () => {
            try {
              return JSON.parse(localStorage.getItem(countsByPlatformKey) || '{}');
            } catch {
              return {};
            }
          };

          const normalizeCounts = (input) => {
            const out = {};
            Object.entries(input || {}).forEach(([key, value]) => {
              const next = Math.max(0, parseInt(value, 10) || 0);
              if (next > 0) out[key] = next;
            });
            return out;
          };

          const persist = (countStore) => {
            localStorage.setItem(platformsKey, JSON.stringify(Array.from(selectedPlatforms)));
            if (activePlatform) localStorage.setItem(platformKey, activePlatform);
            if (countStore) {
              localStorage.setItem(countsByPlatformKey, JSON.stringify(countStore));
            }
          };

          const syncActivePlatform = (countStore) => {
            if (!activePlatform) return;
            formatCounts = normalizeCounts((countStore && countStore[activePlatform]) || {});
            selectedFormats.clear();
            Object.keys(formatCounts).forEach((fmt) => selectedFormats.add(fmt));
          };

          const updateFormatCount = (card, count) => {
            if (!card) return;
            const badge = card.querySelector('.format-count');
            if (!badge) return;
            if (count > 0) {
              badge.textContent = `${count}x`;
              badge.classList.remove('hidden');
            } else {
              badge.classList.add('hidden');
            }
          };

          const updateSummary = () => {
            const countStore = loadCountStore();
            let totalPieces = 0;
            let totalFormats = 0;
            const entries = [];

            Array.from(selectedPlatforms).forEach((platform) => {
              const counts = normalizeCounts(countStore[platform] || {});
              const formats = Object.entries(counts).filter(([, count]) => count > 0);
              if (!formats.length) return;
              totalFormats += formats.length;
              formats.forEach(([fmt, count]) => {
                totalPieces += Number(count || 0);
                entries.push({ platform, fmt, count });
              });
            });

            if (summaryEl) {
              if (!entries.length) {
                summaryEl.textContent = 'Select platforms and formats.';
              } else {
                const platformLabel = `${selectedPlatforms.size} platform${selectedPlatforms.size === 1 ? '' : 's'}`;
                const formatLabelText = `${totalFormats} format${totalFormats === 1 ? '' : 's'}`;
                const pieceLabel = `${totalPieces} piece${totalPieces === 1 ? '' : 's'}`;
                summaryEl.textContent = `${platformLabel} • ${formatLabelText} • ${pieceLabel}`;
              }
            }

            if (enterBtn) {
              enterBtn.disabled = !entries.length;
              enterBtn.classList.toggle('opacity-50', !entries.length);
              enterBtn.classList.toggle('pointer-events-none', !entries.length);
            }

            if (inventoryList && inventoryEmpty) {
              if (!entries.length) {
                inventoryEmpty.classList.remove('hidden');
                inventoryList.classList.add('hidden');
                inventoryList.innerHTML = '';
              } else {
                inventoryEmpty.classList.add('hidden');
                inventoryList.classList.remove('hidden');
                inventoryList.innerHTML = entries.map(({ platform, fmt, count }) => (
                  `<div class="flex items-center justify-between px-4 py-3 rounded-lg bg-slate-50 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-700" data-platform="${platform}" data-format="${fmt}">
                    <div>
                      <div class="text-sm font-semibold text-slate-900 dark:text-white">${fmt}</div>
                      <div class="text-[11px] text-slate-400">${platform}</div>
                    </div>
                    <div class="flex items-center gap-2">
                      <button class="w-8 h-8 rounded-full border border-slate-200 dark:border-slate-700 text-slate-600 hover:border-primary hover:text-primary transition-colors" data-action="decrease" aria-label="Remove piece">-</button>
                      <div class="min-w-[28px] text-center text-sm font-semibold text-slate-900 dark:text-white">${count}</div>
                      <button class="w-8 h-8 rounded-full border border-slate-200 dark:border-slate-700 text-slate-600 hover:border-primary hover:text-primary transition-colors" data-action="increase" aria-label="Add piece">+</button>
                    </div>
                  </div>`
                )).join('');

                inventoryList.querySelectorAll('[data-action="increase"]').forEach((btn) => {
                  btn.addEventListener('click', (event) => {
                    const row = event.currentTarget.closest('[data-platform]');
                    if (!row) return;
                    const platform = row.getAttribute('data-platform');
                    const fmt = formatLabel(row.getAttribute('data-format'));
                    if (!platform || !fmt) return;
                    const countStore = loadCountStore();
                    const current = (countStore[platform] && countStore[platform][fmt]) || 0;
                    setFormatCount(platform, fmt, current + 1);
                  });
                });

                inventoryList.querySelectorAll('[data-action="decrease"]').forEach((btn) => {
                  btn.addEventListener('click', (event) => {
                    const row = event.currentTarget.closest('[data-platform]');
                    if (!row) return;
                    const platform = row.getAttribute('data-platform');
                    const fmt = formatLabel(row.getAttribute('data-format'));
                    if (!platform || !fmt) return;
                    const countStore = loadCountStore();
                    const current = (countStore[platform] && countStore[platform][fmt]) || 0;
                    setFormatCount(platform, fmt, current - 1);
                  });
                });
              }
            }

            const inventoryTotal = document.getElementById('inventory-total');
            if (inventoryTotal) {
              inventoryTotal.textContent = `${totalPieces} piece${totalPieces === 1 ? '' : 's'}`;
            }
          };

          const formatCardMarkup = (fmt) => {
            const check = '<div class="absolute top-2 right-2 text-primary hidden format-check"><span class="material-symbols-outlined text-lg">check_circle</span></div>';
            const badge = '<div class="absolute top-2 left-2 text-[10px] font-semibold text-primary bg-orange-50 border border-orange-200 rounded-full px-2 py-0.5 hidden format-count"></div>';
            const shape = (() => {
              if (fmt.shape === 'stack') {
                return '<div class="relative w-12 h-12"><div class="absolute inset-0 bg-slate-100 dark:bg-slate-700 rounded-sm translate-x-2 -translate-y-2 border border-slate-300 dark:border-slate-600"></div><div class="absolute inset-0 bg-white dark:bg-slate-800 rounded-sm border-2 border-primary"></div></div>';
              }
              if (fmt.shape === 'tall') {
                return '<div class="w-8 h-14 border-2 border-slate-300 dark:border-slate-600 group-hover:border-primary dark:group-hover:border-primary rounded-sm"></div>';
              }
              if (fmt.shape === 'video') {
                return '<span class="material-symbols-outlined absolute text-slate-300 group-hover:text-primary/20 text-4xl">videocam</span><div class="w-8 h-14 border-2 border-slate-300 dark:border-slate-600 group-hover:border-primary dark:group-hover:border-primary rounded-sm z-10"></div>';
              }
              if (fmt.shape === 'wide') {
                return '<div class="w-16 h-10 border-2 border-slate-300 dark:border-slate-600 group-hover:border-primary dark:group-hover:border-primary rounded-sm"></div>';
              }
              if (fmt.shape === 'text') {
                return '<div class="w-14 h-10 border-2 border-dashed border-slate-300 dark:border-slate-600 group-hover:border-primary dark:group-hover:border-primary rounded-sm flex items-center justify-center text-[10px] uppercase tracking-widest text-slate-300">Text</div>';
              }
              return '<div class="w-12 h-12 border-2 border-slate-300 dark:border-slate-600 group-hover:border-primary dark:group-hover:border-primary rounded-sm"></div>';
            })();

            return `<div class="group format-card cursor-pointer" data-format="${fmt.name}">
  <div class="format-box aspect-[4/3] bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 hover:border-primary dark:hover:border-primary rounded-xl p-4 flex items-center justify-center mb-3 transition-all hover:shadow-md relative">
    ${check}
    ${badge}
    ${shape}
  </div>
  <div class="text-center">
    <p class="format-label font-bold text-sm text-slate-900 dark:text-white">${fmt.name}</p>
    <p class="text-[10px] text-slate-500 uppercase tracking-wide">${fmt.meta}</p>
  </div>
</div>`;
          };

          const renderFormats = (platform) => {
            if (!formatGrid || !platform) return;
            const formats = platformFormats[platform] || platformFormats['Instagram'];
            const countStore = loadCountStore();
            formatCounts = normalizeCounts(countStore[platform] || {});
            selectedFormats.clear();
            Object.keys(formatCounts).forEach((fmt) => selectedFormats.add(fmt));

            formatGrid.innerHTML = formats.map(formatCardMarkup).join('');

            const formatCards = Array.from(formatGrid.querySelectorAll('[data-format]'));
            formatCards.forEach((card) => {
              const name = formatLabel(card.getAttribute('data-format'));
              const count = formatCounts[name] || 0;
              const isSelected = count > 0;
              applyFormatState(card, isSelected);
              updateFormatCount(card, count);
              card.addEventListener('click', () => {
                if (!name || !activePlatform) return;
                setFormatCount(activePlatform, name, (formatCounts[name] || 0) + 1);
              });
            });

            updateSummary();
            updatePlatformHighlights();
          };

          const setFormatCount = (platform, name, count) => {
            if (!platform || !name) return;
            const next = Math.max(0, parseInt(count, 10) || 0);
            const countStore = loadCountStore();
            const platformCounts = normalizeCounts(countStore[platform] || {});

            if (next <= 0) {
              delete platformCounts[name];
            } else {
              platformCounts[name] = next;
            }

            if (!Object.keys(platformCounts).length) {
              delete countStore[platform];
              selectedPlatforms.delete(platform);
            } else {
              countStore[platform] = platformCounts;
              selectedPlatforms.add(platform);
            }

            if (platform === activePlatform) {
              formatCounts = { ...platformCounts };
              selectedFormats.clear();
              Object.keys(formatCounts).forEach((fmt) => selectedFormats.add(fmt));
              const card = formatGrid?.querySelector(`[data-format="${CSS.escape(name)}"]`);
              applyFormatState(card, next > 0);
              updateFormatCount(card, next);
            }

            localStorage.setItem(countsByPlatformKey, JSON.stringify(countStore));
            persist(countStore);
            updateSummary();
            updatePlatformHighlights();
          };

          const updatePlatformHighlights = () => {
            const countStore = loadCountStore();
            platformCards.forEach((card) => {
              const name = card.getAttribute('data-platform');
              const counts = name ? countStore[name] : null;
              const total = counts ? Object.values(counts).reduce((sum, val) => sum + Number(val || 0), 0) : 0;
              const hasPieces = total > 0;
              const isSelected = name ? selectedPlatforms.has(name) : false;
              const isActive = name === activePlatform;

              card.dataset.selected = isSelected ? 'true' : 'false';
              card.classList.toggle('has-pieces', hasPieces);

              card.classList.toggle('bg-orange-50/40', (isSelected || hasPieces) && !isActive);
              card.classList.toggle('border-orange-200', (isSelected || hasPieces) && !isActive);
              card.classList.toggle('ring-2', (isSelected || hasPieces) && !isActive);
              card.classList.toggle('ring-orange-200', (isSelected || hasPieces) && !isActive);

              applyPlatformState(card, isActive);

              const badge = card.querySelector('.platform-count');
              if (badge) {
                if (hasPieces) {
                  badge.textContent = String(total);
                  badge.classList.remove('hidden');
                  badge.classList.add('flex');
                } else {
                  badge.textContent = '';
                  badge.classList.add('hidden');
                  badge.classList.remove('flex');
                }
              }
            });
          };

          const setActivePlatform = (platform) => {
            activePlatform = platform;
            if (activePlatform) {
              localStorage.setItem(platformKey, activePlatform);
            } else {
              localStorage.removeItem(platformKey);
            }
            renderFormats(activePlatform);
          };

          const initialize = () => {
            loadSelectedPlatforms().forEach((platform) => selectedPlatforms.add(platform));
            const storedActive = localStorage.getItem(platformKey);
            const fallbackPlatform = platformCards[0]?.getAttribute('data-platform') || null;
            activePlatform = storedActive || Array.from(selectedPlatforms)[0] || fallbackPlatform;

            platformCards.forEach((card) => {
              const name = card.getAttribute('data-platform');
              const isActive = name === activePlatform;
              applyPlatformState(card, isActive);
              card.addEventListener('click', () => {
                if (!name) return;
                if (!selectedPlatforms.has(name)) {
                  selectedPlatforms.add(name);
                  persist(loadCountStore());
                }
                setActivePlatform(name);
              });
            });

            if (activePlatform) {
              renderFormats(activePlatform);
            }
            updatePlatformHighlights();
            updateSummary();
          };

          selectAllBtn?.addEventListener('click', () => {
            if (!activePlatform) return;
            const cards = Array.from(document.querySelectorAll('#format-grid [data-format]'));
            cards.forEach((card) => {
              const name = formatLabel(card.getAttribute('data-format'));
              if (!name) return;
              const current = formatCounts[name] || 0;
              setFormatCount(activePlatform, name, current > 0 ? current : 1);
            });
          });

          unselectAllBtn?.addEventListener('click', () => {
            selectedFormats.clear();
            selectedPlatforms.clear();
            formatCounts = {};
            const countStore = {};
            localStorage.setItem(formatsByPlatformKey, JSON.stringify({}));
            localStorage.setItem(countsByPlatformKey, JSON.stringify({}));
            localStorage.removeItem(platformKey);
            localStorage.removeItem(platformsKey);
            localStorage.removeItem(formatKey);
            activePlatform = platformCards[0]?.getAttribute('data-platform') || null;
            renderFormats(activePlatform);
            updateSummary();
            updatePlatformHighlights();
          });

          enterBtn?.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopImmediatePropagation();
            const platforms = Array.from(selectedPlatforms);
            const countStore = loadCountStore();
            const formats = Array.from(new Set(Object.keys(countStore).flatMap((p) => Object.keys(countStore[p] || {}))));

            const inventoryItems = [];
            Object.entries(countStore).forEach(([platform, formatCounts]) => {
              Object.entries(formatCounts || {}).forEach(([format, total]) => {
                const qty = Math.max(0, parseInt(total, 10) || 0);
                for (let i = 1; i <= qty; i++) {
                  const platformId = platformAliasMap[platform] || platform;
                  inventoryItems.push({
                    id: `${platform.toLowerCase().replace(/[^a-z0-9]+/g, '-')}-${format.toLowerCase().replace(/[^a-z0-9]+/g, '-')}-${i}`,
                    platform,
                    platformId,
                    format,
                    index: i,
                    total: qty
                  });
                }
              });
            });

            if (inventoryItems.length) {
              const inventoryState = {};
              inventoryItems.forEach((item) => {
                inventoryState[item.id] = { copy: '', status: 'pending', history: [] };
              });
              localStorage.setItem('edro_inventory_items', JSON.stringify(inventoryItems));
              localStorage.setItem('edro_inventory_state', JSON.stringify(inventoryState));
              localStorage.setItem('edro_active_inventory_id', inventoryItems[0].id);
            }

            const headerDate = document.querySelector('header span.text-xs.font-semibold.text-slate-600')?.textContent?.trim();
            if (headerDate) {
              localStorage.setItem('edro_publish_date', headerDate);
            }
            const params = new URLSearchParams({
              platforms: platforms.join(','),
              formats: formats.join(',')
            });
            if (context?.clientId) params.set('clientId', context.clientId);
            if (context?.client) params.set('client', context.client);
            if (context?.date) params.set('date', context.date);
            if (context?.event) params.set('event', context.event);
            const route = `/studio/editor?${params.toString()}`;
            const target = window.top || window;
            target.location.href = route;
          });

          loadPlatformProfiles().finally(() => {
            initialize();
          });
        })();
</script>
<script src="/ux/edro-links.js"></script>
</body></html>



